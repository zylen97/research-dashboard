name: ğŸš€ è‡ªåŠ¨éƒ¨ç½²åˆ°VPS

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: ğŸ” Shellè„šæœ¬è´¨é‡æ£€æŸ¥
      run: |
        # å®‰è£…ShellCheck
        sudo apt-get update && sudo apt-get install -y shellcheck
        
        # æ‰§è¡Œæ£€æŸ¥
        chmod +x scripts/check-shell-scripts.sh
        ./scripts/check-shell-scripts.sh
        
        # å¦‚æœæœ‰é”™è¯¯ï¼Œæ˜¾ç¤ºæŠ¥å‘Š
        if [ -f shell-check-report.txt ]; then
          echo "=== Shellè„šæœ¬æ£€æŸ¥æŠ¥å‘Š ==="
          cat shell-check-report.txt
        fi
    
    - name: ğŸš€ éƒ¨ç½²åˆ°VPS
      uses: appleboy/ssh-action@v0.1.8
      with:
        host: 45.149.156.216
        username: root
        key: ${{ secrets.VPS_SSH_KEY }}
        script: |
          echo "ğŸ”„ å¼€å§‹è‡ªåŠ¨éƒ¨ç½²..."
          cd /var/www/research-dashboard
          
          # æ‰§è¡Œéƒ¨ç½²è„šæœ¬ï¼ˆè„šæœ¬å†…ä¼šæ‹‰å–æœ€æ–°ä»£ç ï¼‰
          ./deploy-scripts/vps-update.sh
          
          echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
          echo "ğŸ“… éƒ¨ç½²æ—¶é—´: $(date)"