# Shellè„šæœ¬ç¼–å†™è§„èŒƒ

## ğŸ¯ ç›®æ ‡
å»ºç«‹ç»Ÿä¸€çš„Shellè„šæœ¬ç¼–å†™æ ‡å‡†ï¼Œæé«˜ä»£ç è´¨é‡ï¼Œå‡å°‘é”™è¯¯ï¼Œæå‡ç»´æŠ¤æ€§ã€‚

## ğŸ“‹ åŸºæœ¬è§„èŒƒ

### 1. æ–‡ä»¶å¤´éƒ¨
æ¯ä¸ªShellè„šæœ¬å¿…é¡»åŒ…å«ä»¥ä¸‹å¤´éƒ¨ï¼š

```bash
#!/bin/bash

# è„šæœ¬åç§°å’Œç”¨é€”çš„ç®€çŸ­æè¿°
# ä½œè€…ï¼š[ä½œè€…å]
# åˆ›å»ºæ—¶é—´ï¼š[æ—¥æœŸ]
# æœ€åä¿®æ”¹ï¼š[æ—¥æœŸ]

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º
```

### 2. å˜é‡å‘½å

#### è§„åˆ™
- ä½¿ç”¨æè¿°æ€§çš„å˜é‡å
- å…¨å±€å˜é‡ä½¿ç”¨å¤§å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- å±€éƒ¨å˜é‡ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- åªè¯»å˜é‡ä½¿ç”¨ `readonly` å£°æ˜

#### ç¤ºä¾‹
```bash
# å…¨å±€å˜é‡
PROJECT_ROOT="/var/www/project"
readonly CONFIG_FILE="/etc/project.conf"

# å±€éƒ¨å˜é‡ï¼ˆåœ¨å‡½æ•°å†…ï¼‰
function process_data() {
    local input_file="$1"
    local output_dir="$2"
    local temp_file="/tmp/processing.tmp"
}
```

### 3. å‡½æ•°å®šä¹‰

#### è§„åˆ™
- å‡½æ•°åä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- å‡½æ•°å†…çš„å˜é‡å¿…é¡»ä½¿ç”¨ `local` å£°æ˜
- å‡½æ•°å‰æ·»åŠ ç®€çŸ­æ³¨é‡Šè¯´æ˜ç”¨é€”

#### ç¤ºä¾‹
```bash
# å¤„ç†æ—¥å¿—æ–‡ä»¶
process_log_file() {
    local log_file="$1"
    local output_file="$2"
    
    if [ ! -f "$log_file" ]; then
        echo "é”™è¯¯ï¼šæ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨: $log_file" >&2
        return 1
    fi
    
    # å¤„ç†é€»è¾‘...
}
```

### 4. é”™è¯¯å¤„ç†

#### åŸºæœ¬åŸåˆ™
- ä½¿ç”¨ `set -e` åœ¨è„šæœ¬å¼€å¤´
- é‡è¦æ“ä½œåæ£€æŸ¥è¿”å›å€¼
- æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨é”™è¯¯é€€å‡ºå‡½æ•°

#### ç¤ºä¾‹
```bash
# é”™è¯¯å¤„ç†å‡½æ•°
error_exit() {
    local message="$1"
    local exit_code="${2:-1}"
    echo "é”™è¯¯: $message" >&2
    exit "$exit_code"
}

# ä½¿ç”¨ç¤ºä¾‹
cp "$source_file" "$dest_file" || error_exit "æ–‡ä»¶å¤åˆ¶å¤±è´¥"
```

### 5. å‚æ•°å¤„ç†

#### åŸºæœ¬æ£€æŸ¥
```bash
# æ£€æŸ¥å‚æ•°æ•°é‡
if [ $# -lt 2 ]; then
    echo "ç”¨æ³•: $0 <è¾“å…¥æ–‡ä»¶> <è¾“å‡ºç›®å½•>" >&2
    exit 1
fi

# èµ‹å€¼ç»™æè¿°æ€§å˜é‡
input_file="$1"
output_dir="$2"

# éªŒè¯å‚æ•°
[ -f "$input_file" ] || error_exit "è¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨: $input_file"
[ -d "$output_dir" ] || error_exit "è¾“å‡ºç›®å½•ä¸å­˜åœ¨: $output_dir"
```

### 6. æ–‡ä»¶è·¯å¾„å¤„ç†

#### è§„åˆ™
- å§‹ç»ˆä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äºå·²çŸ¥åŸºå‡†çš„è·¯å¾„
- ä½¿ç”¨ `"$var"` å¼•ç”¨å˜é‡é¿å…ç©ºæ ¼é—®é¢˜
- æ£€æŸ¥æ–‡ä»¶/ç›®å½•å­˜åœ¨æ€§

#### ç¤ºä¾‹
```bash
# è·å–è„šæœ¬æ‰€åœ¨ç›®å½•
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

# å®‰å…¨çš„æ–‡ä»¶æ“ä½œ
if [ -f "$config_file" ]; then
    source "$config_file"
fi
```

## ğŸš« å¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•

### 1. `local` å…³é”®å­—ä½¿ç”¨é”™è¯¯

âŒ **é”™è¯¯**ï¼šåœ¨å‡½æ•°å¤–ä½¿ç”¨ `local`
```bash
# è„šæœ¬ä¸»ä½“ä¸­
local var="value"  # é”™è¯¯ï¼
```

âœ… **æ­£ç¡®**ï¼šåªåœ¨å‡½æ•°å†…ä½¿ç”¨ `local`
```bash
my_function() {
    local var="value"  # æ­£ç¡®
}

# è„šæœ¬ä¸»ä½“ä¸­
var="value"  # æ­£ç¡®
```

### 2. å˜é‡å¼•ç”¨é”™è¯¯

âŒ **é”™è¯¯**ï¼šä¸ä½¿ç”¨å¼•å·
```bash
cp $source_file $dest_file  # å¦‚æœè·¯å¾„æœ‰ç©ºæ ¼ä¼šå‡ºé”™
```

âœ… **æ­£ç¡®**ï¼šä½¿ç”¨åŒå¼•å·
```bash
cp "$source_file" "$dest_file"
```

### 3. è·¯å¾„æ‹¼æ¥é”™è¯¯

âŒ **é”™è¯¯**ï¼šç®€å•å­—ç¬¦ä¸²æ‹¼æ¥
```bash
full_path=$dir/$file  # å¯èƒ½äº§ç”ŸåŒæ–œæ 
```

âœ… **æ­£ç¡®**ï¼šä½¿ç”¨è·¯å¾„æ‹¼æ¥å‡½æ•°æˆ–æ£€æŸ¥
```bash
full_path="$dir/$file"
# æˆ–è€…
full_path=$(realpath "$dir/$file")
```

### 4. ç¼ºå°‘é”™è¯¯æ£€æŸ¥

âŒ **é”™è¯¯**ï¼šä¸æ£€æŸ¥å‘½ä»¤æ‰§è¡Œç»“æœ
```bash
mkdir /some/path
cd /some/path
```

âœ… **æ­£ç¡®**ï¼šæ£€æŸ¥æ¯ä¸ªå…³é”®æ“ä½œ
```bash
mkdir /some/path || error_exit "åˆ›å»ºç›®å½•å¤±è´¥"
cd /some/path || error_exit "è¿›å…¥ç›®å½•å¤±è´¥"
```

## ğŸ”§ æ¨èå·¥å…·

### 1. ShellCheck
é™æ€åˆ†æå·¥å…·ï¼Œç”¨äºå‘ç°Shellè„šæœ¬ä¸­çš„é—®é¢˜ï¼š

```bash
# å®‰è£…
sudo apt-get install shellcheck

# ä½¿ç”¨
shellcheck script.sh
```

### 2. è¯­æ³•æ£€æŸ¥
åœ¨æ‰§è¡Œå‰æ£€æŸ¥è¯­æ³•ï¼š

```bash
bash -n script.sh
```

### 3. è°ƒè¯•æ¨¡å¼
å¼€å‘æ—¶ä½¿ç”¨è°ƒè¯•æ¨¡å¼ï¼š

```bash
bash -x script.sh  # æ˜¾ç¤ºæ‰§è¡Œçš„æ¯ä¸€è¡Œ
```

## ğŸ“ è„šæœ¬æ¨¡æ¿

åˆ›å»ºæ–°è„šæœ¬æ—¶ä½¿ç”¨æ­¤æ¨¡æ¿ï¼š

```bash
#!/bin/bash

# [è„šæœ¬ç”¨é€”æè¿°]
# ä½œè€…ï¼š[ä½œè€…å]
# åˆ›å»ºæ—¶é—´ï¼š$(date +%Y-%m-%d)

set -e

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# è·å–è„šæœ¬ç›®å½•
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# é”™è¯¯å¤„ç†å‡½æ•°
error_exit() {
    local message="$1"
    local exit_code="${2:-1}"
    echo -e "${RED}é”™è¯¯: $message${NC}" >&2
    exit "$exit_code"
}

# ä¸»å‡½æ•°
main() {
    # å‚æ•°æ£€æŸ¥
    if [ $# -lt 1 ]; then
        echo "ç”¨æ³•: $0 <å‚æ•°>" >&2
        exit 1
    fi
    
    # ä¸»è¦é€»è¾‘
    echo -e "${GREEN}è„šæœ¬æ‰§è¡ŒæˆåŠŸ${NC}"
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
```

## ğŸ” è´¨é‡æ£€æŸ¥

ä½¿ç”¨é¡¹ç›®æä¾›çš„æ£€æŸ¥å·¥å…·ï¼š

```bash
# æ‰§è¡Œå…¨é¢æ£€æŸ¥
./scripts/check-shell-scripts.sh

# æŸ¥çœ‹æ£€æŸ¥æŠ¥å‘Š
cat shell-check-report.txt
```

## ğŸ“š å‚è€ƒèµ„æº

- [Google Shell Style Guide](https://google.github.io/styleguide/shellguide.html)
- [ShellCheck Wiki](https://github.com/koalaman/shellcheck/wiki)
- [Advanced Bash-Scripting Guide](https://tldp.org/LDP/abs/html/)

éµå¾ªè¿™äº›è§„èŒƒå°†æ˜¾è‘—æé«˜Shellè„šæœ¬çš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ï¼