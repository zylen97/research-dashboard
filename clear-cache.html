<!DOCTYPE html>
<html>
<head>
    <title>Research Dashboard - ç¼“å­˜æ¸…ç†å·¥å…·</title>
    <meta charset="utf-8">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container { 
            max-width: 600px; 
            background: white; 
            padding: 40px; 
            border-radius: 10px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            text-align: center;
        }
        h1 { 
            color: #ff4d4f; 
            margin-bottom: 30px;
            font-size: 28px;
        }
        .status { 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 5px; 
            font-size: 18px;
        }
        .success { 
            background: #f6ffed; 
            color: #52c41a; 
            border: 1px solid #b7eb8f;
        }
        .error { 
            background: #fff2f0; 
            color: #ff4d4f; 
            border: 1px solid #ffccc7;
        }
        .info { 
            background: #e6f7ff; 
            color: #1890ff; 
            border: 1px solid #91d5ff;
        }
        button { 
            background: #ff4d4f; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 18px; 
            margin: 10px;
            transition: background 0.3s;
        }
        button:hover { 
            background: #ff7875; 
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .instructions {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: left;
        }
        .instructions li {
            margin: 10px 0;
        }
        .countdown {
            font-size: 48px;
            color: #ff4d4f;
            margin: 20px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¹ Research Dashboard ç¼“å­˜æ¸…ç†</h1>
        
        <div id="status" class="status info">
            å‡†å¤‡æ¸…ç†ç¼“å­˜...
        </div>
        
        <div id="countdown" class="countdown" style="display: none;"></div>
        
        <div>
            <button id="clearBtn" onclick="clearAllCache()">å¼€å§‹æ¸…ç†ç¼“å­˜</button>
            <button onclick="window.location.href='http://45.149.156.216:3001'">è¿”å›ç³»ç»Ÿ</button>
        </div>
        
        <div class="instructions">
            <h3>æ¸…ç†æ­¥éª¤ï¼š</h3>
            <ol>
                <li>ç‚¹å‡»"å¼€å§‹æ¸…ç†ç¼“å­˜"æŒ‰é’®</li>
                <li>ç­‰å¾…3ç§’å€’è®¡æ—¶</li>
                <li>è‡ªåŠ¨è·³è½¬åˆ°Ideasç®¡ç†é¡µé¢</li>
                <li>å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·ä½¿ç”¨ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°</li>
            </ol>
        </div>
    </div>
    
    <script>
    let clearing = false;
    
    async function clearAllCache() {
        if (clearing) return;
        clearing = true;
        
        const btn = document.getElementById('clearBtn');
        const status = document.getElementById('status');
        const countdown = document.getElementById('countdown');
        
        btn.disabled = true;
        btn.textContent = 'æ¸…ç†ä¸­...';
        
        try {
            // 1. æ¸…ç†localStorage
            localStorage.clear();
            console.log('âœ… localStorageå·²æ¸…ç†');
            
            // 2. æ¸…ç†sessionStorage
            sessionStorage.clear();
            console.log('âœ… sessionStorageå·²æ¸…ç†');
            
            // 3. å°è¯•æ¸…ç†Service Worker
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (let registration of registrations) {
                    await registration.unregister();
                    console.log('âœ… Service Workerå·²æ³¨é”€');
                }
            }
            
            // 4. å°è¯•æ¸…ç†Cache Storage
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                await Promise.all(
                    cacheNames.map(name => caches.delete(name))
                );
                console.log('âœ… Cache Storageå·²æ¸…ç†');
            }
            
            status.className = 'status success';
            status.innerHTML = 'âœ… ç¼“å­˜æ¸…ç†å®Œæˆï¼å³å°†è·³è½¬...';
            
            // å€’è®¡æ—¶
            countdown.style.display = 'block';
            let count = 3;
            countdown.textContent = count;
            
            const timer = setInterval(() => {
                count--;
                countdown.textContent = count;
                
                if (count <= 0) {
                    clearInterval(timer);
                    // è·³è½¬åˆ°Ideasç®¡ç†é¡µé¢
                    window.location.href = 'http://45.149.156.216:3001/ideas-management';
                }
            }, 1000);
            
        } catch (error) {
            status.className = 'status error';
            status.innerHTML = `âŒ æ¸…ç†å¤±è´¥: ${error.message}`;
            btn.disabled = false;
            btn.textContent = 'é‡è¯•';
            clearing = false;
        }
    }
    
    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºç¼“å­˜ä¿¡æ¯
    window.onload = () => {
        const status = document.getElementById('status');
        let info = 'ğŸ“Š å½“å‰ç¼“å­˜çŠ¶æ€ï¼š<br>';
        
        // localStorageå¤§å°
        let localStorageSize = 0;
        for (let key in localStorage) {
            localStorageSize += localStorage[key].length;
        }
        info += `â€¢ localStorage: ${Math.round(localStorageSize/1024)}KB<br>`;
        
        // Service WorkerçŠ¶æ€
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(regs => {
                if (regs.length > 0) {
                    info += `â€¢ Service Worker: ${regs.length}ä¸ªæ´»è·ƒ<br>`;
                }
            });
        }
        
        status.innerHTML = info + '<br>ç‚¹å‡»æŒ‰é’®å¼€å§‹æ¸…ç†';
    };
    </script>
</body>
</html>