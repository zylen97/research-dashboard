# Nginx配置模板 - 用于快速部署新的Web应用
# 使用方法：
# 1. 复制此文件并重命名为 nginx-PORT.conf
# 2. 替换所有 {{变量}} 为实际值
# 3. 部署到 /etc/nginx/sites-available/

server {
    listen {{PORT}};
    server_name {{SERVER_IP}} localhost;

    # 前端静态文件
    location / {
        root {{WEB_ROOT}};
        try_files $uri $uri/ /index.html;
        
        # 安全头
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
    }
    
    # HTML文件 - 不缓存
    location ~* \.html$ {
        root {{WEB_ROOT}};
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }
    
    # JS/CSS文件 - 短缓存以便快速更新
    location ~* \.(js|css)$ {
        root {{WEB_ROOT}};
        expires 1h;
        add_header Cache-Control "public, must-revalidate";
    }
    
    # 图片 - 长缓存
    location ~* \.(jpg|jpeg|png|gif|ico|svg|webp)$ {
        root {{WEB_ROOT}};
        expires 7d;
        add_header Cache-Control "public";
    }

    # 后端API代理（如果需要）
    location {{API_PATH}}/ {
        proxy_pass http://localhost:{{BACKEND_PORT}};
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        
        # 真实IP头
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 超时设置
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}

# 变量说明：
# {{PORT}} - Web应用监听端口（如：3001, 3002, 3003）
# {{SERVER_IP}} - 服务器IP地址（如：45.149.156.216）
# {{WEB_ROOT}} - 前端文件根目录（如：/var/www/app-name）
# {{API_PATH}} - API路径前缀（如：/api, /api/v1）
# {{BACKEND_PORT}} - 后端服务端口（如：8080, 8081, 8082）