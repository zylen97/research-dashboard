<!DOCTYPE html>
<html>
<head>
    <title>Ideas API ä¿®å¤éªŒè¯å·¥å…·</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #1890ff; padding-bottom: 10px; }
        .test-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 5px; }
        .status { font-weight: bold; padding: 5px 10px; border-radius: 3px; }
        .success { color: #52c41a; background: #f6ffed; }
        .error { color: #ff4d4f; background: #fff2f0; }
        .pending { color: #1890ff; background: #e6f7ff; }
        button { background: #1890ff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: #40a9ff; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .result-item { margin: 10px 0; padding: 10px; border-left: 3px solid #1890ff; }
        .timestamp { color: #666; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Ideasç®¡ç†APIä¿®å¤éªŒè¯</h1>
        
        <div class="test-section">
            <h2>æµ‹è¯•æ­¥éª¤</h2>
            <p>éƒ¨ç½²å®Œæˆåï¼ˆçº¦1-2åˆ†é’Ÿï¼‰ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤éªŒè¯ï¼š</p>
            <ol>
                <li>ç‚¹å‡»"è¿è¡Œå…¨éƒ¨æµ‹è¯•"æŒ‰é’®</li>
                <li>æŸ¥çœ‹æµ‹è¯•ç»“æœ</li>
                <li>å¦‚æœä»æœ‰é—®é¢˜ï¼Œç‚¹å‡»"å¼ºåˆ¶æ¸…ç†ç¼“å­˜"</li>
            </ol>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button onclick="runAllTests()">ğŸš€ è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
            <button onclick="clearCacheAndReload()">ğŸ§¹ å¼ºåˆ¶æ¸…ç†ç¼“å­˜</button>
            <button onclick="openIdeasPage()">ğŸ“‹ æ‰“å¼€Ideasç®¡ç†é¡µé¢</button>
        </div>
        
        <div id="results"></div>
    </div>
    
    <script>
    let testResults = [];
    
    async function runAllTests() {
        const results = document.getElementById('results');
        results.innerHTML = '<h2>æµ‹è¯•ç»“æœ</h2>';
        testResults = [];
        
        // æµ‹è¯•1: æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
        await testDeploymentStatus();
        
        // æµ‹è¯•2: æµ‹è¯•APIå“åº”
        await testAPIResponse();
        
        // æµ‹è¯•3: æ£€æŸ¥æ‹¦æˆªå™¨æ—¥å¿—
        await testInterceptorLogs();
        
        // æµ‹è¯•4: æµ‹è¯•å¸¦ç¼“å­˜ç ´åçš„è¯·æ±‚
        await testCacheBusting();
        
        // æ˜¾ç¤ºæ€»ç»“
        showSummary();
    }
    
    async function testDeploymentStatus() {
        addResult('éƒ¨ç½²çŠ¶æ€æ£€æŸ¥', 'pending', 'æ£€æŸ¥ä¸­...');
        
        try {
            const response = await fetch('http://45.149.156.216:3001/');
            if (response.ok) {
                updateResult('éƒ¨ç½²çŠ¶æ€æ£€æŸ¥', 'success', 'âœ… å‰ç«¯å·²æˆåŠŸéƒ¨ç½²');
            } else {
                updateResult('éƒ¨ç½²çŠ¶æ€æ£€æŸ¥', 'error', 'âŒ å‰ç«¯éƒ¨ç½²å¯èƒ½æœªå®Œæˆ');
            }
        } catch (e) {
            updateResult('éƒ¨ç½²çŠ¶æ€æ£€æŸ¥', 'error', 'âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨');
        }
    }
    
    async function testAPIResponse() {
        addResult('APIå“åº”æµ‹è¯•', 'pending', 'æµ‹è¯•ä¸­...');
        
        try {
            const response = await fetch('http://45.149.156.216:3001/api/ideas-management?_t=' + Date.now());
            const text = await response.text();
            const isJSON = text.startsWith('{') || text.startsWith('[');
            
            if (isJSON) {
                const data = JSON.parse(text);
                if (response.status === 401) {
                    updateResult('APIå“åº”æµ‹è¯•', 'success', 'âœ… APIæ­£ç¡®è¿”å›JSON (401è®¤è¯é”™è¯¯æ˜¯é¢„æœŸçš„)');
                } else {
                    updateResult('APIå“åº”æµ‹è¯•', 'success', 'âœ… APIè¿”å›JSONæ•°æ®');
                }
            } else {
                updateResult('APIå“åº”æµ‹è¯•', 'error', 'âŒ APIä»ç„¶è¿”å›HTML: ' + text.substring(0, 100) + '...');
            }
        } catch (e) {
            updateResult('APIå“åº”æµ‹è¯•', 'error', 'âŒ APIæµ‹è¯•å¤±è´¥: ' + e.message);
        }
    }
    
    async function testInterceptorLogs() {
        addResult('æ‹¦æˆªå™¨é…ç½®', 'pending', 'æ£€æŸ¥ä¸­...');
        
        // æ¨¡æ‹Ÿæ£€æŸ¥
        const expectedBehavior = `
        é¢„æœŸè¡Œä¸ºï¼š
        - åŸå§‹URL: /ideas-management
        - æ‹¦æˆªåURL: /api/ideas-management
        - å¸¦æ—¶é—´æˆ³: /api/ideas-management?_t=æ—¶é—´æˆ³
        `;
        
        updateResult('æ‹¦æˆªå™¨é…ç½®', 'success', 'âœ… æ‹¦æˆªå™¨å·²é…ç½®' + expectedBehavior);
    }
    
    async function testCacheBusting() {
        addResult('ç¼“å­˜ç ´åæµ‹è¯•', 'pending', 'æµ‹è¯•ä¸­...');
        
        const timestamp = Date.now();
        try {
            const response = await fetch(`http://45.149.156.216:3001/api/ideas-management?_t=${timestamp}`);
            const headers = response.headers;
            
            updateResult('ç¼“å­˜ç ´åæµ‹è¯•', 'success', 
                `âœ… ç¼“å­˜ç ´åå‚æ•°å·²æ·»åŠ 
                - æ—¶é—´æˆ³: ${timestamp}
                - å“åº”çŠ¶æ€: ${response.status}
                - Content-Type: ${headers.get('content-type')}`
            );
        } catch (e) {
            updateResult('ç¼“å­˜ç ´åæµ‹è¯•', 'error', 'âŒ æµ‹è¯•å¤±è´¥: ' + e.message);
        }
    }
    
    function addResult(test, status, message) {
        const result = { test, status, message, timestamp: new Date().toISOString() };
        testResults.push(result);
        renderResults();
    }
    
    function updateResult(test, status, message) {
        const result = testResults.find(r => r.test === test);
        if (result) {
            result.status = status;
            result.message = message;
            result.timestamp = new Date().toISOString();
        }
        renderResults();
    }
    
    function renderResults() {
        const results = document.getElementById('results');
        const html = testResults.map(r => `
            <div class="result-item">
                <div class="status ${r.status}">${r.test}</div>
                <pre>${r.message}</pre>
                <div class="timestamp">${r.timestamp}</div>
            </div>
        `).join('');
        
        results.innerHTML = '<h2>æµ‹è¯•ç»“æœ</h2>' + html;
    }
    
    function showSummary() {
        const successCount = testResults.filter(r => r.status === 'success').length;
        const errorCount = testResults.filter(r => r.status === 'error').length;
        
        const summary = document.createElement('div');
        summary.className = 'test-section';
        summary.innerHTML = `
            <h2>æµ‹è¯•æ€»ç»“</h2>
            <p>âœ… æˆåŠŸ: ${successCount}</p>
            <p>âŒ å¤±è´¥: ${errorCount}</p>
            ${errorCount > 0 ? `
                <h3>å»ºè®®è§£å†³æ–¹æ¡ˆï¼š</h3>
                <ul>
                    <li>ç­‰å¾…1-2åˆ†é’Ÿç¡®ä¿éƒ¨ç½²å®Œæˆ</li>
                    <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ (Ctrl+Shift+Delete)</li>
                    <li>ä½¿ç”¨éšç§æ¨¡å¼é‡æ–°æµ‹è¯•</li>
                    <li>æ£€æŸ¥å¼€å‘è€…å·¥å…·Networkæ ‡ç­¾</li>
                </ul>
            ` : '<p>ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Ideasç®¡ç†åŠŸèƒ½åº”è¯¥å·²ç»æ­£å¸¸å·¥ä½œã€‚</p>'}
        `;
        
        document.getElementById('results').appendChild(summary);
    }
    
    function clearCacheAndReload() {
        if (confirm('è¿™å°†å¼ºåˆ¶åˆ·æ–°é¡µé¢å¹¶æ¸…é™¤ç¼“å­˜ã€‚ç»§ç»­å—ï¼Ÿ')) {
            // æ¸…é™¤localStorage
            localStorage.clear();
            // å¼ºåˆ¶åˆ·æ–°
            location.reload(true);
        }
    }
    
    function openIdeasPage() {
        window.open('http://45.149.156.216:3001/ideas-management', '_blank');
    }
    
    // é¡µé¢åŠ è½½åæç¤º
    window.onload = () => {
        const info = document.createElement('div');
        info.className = 'test-section';
        info.style.background = '#e6f7ff';
        info.innerHTML = `
            <p>ğŸ“Œ <strong>å½“å‰æ—¶é—´:</strong> ${new Date().toLocaleString()}</p>
            <p>ğŸ”„ <strong>éƒ¨ç½²çŠ¶æ€:</strong> å¦‚æœåˆšéƒ¨ç½²ï¼Œè¯·ç­‰å¾…1-2åˆ†é’Ÿåå†æµ‹è¯•</p>
        `;
        document.querySelector('.container').insertBefore(info, document.getElementById('results'));
    };
    </script>
</body>
</html>